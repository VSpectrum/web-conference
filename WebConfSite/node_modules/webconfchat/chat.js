var io = require('socket.io');
var socketio = io.listen(4444, { log: false });

socketio.sockets.on('connection', function (socket) {

	socket.on('enter', function(data){
		console.log(data.uname+" has entered "+data.sessname);
		socket.join(data.sessname);
		data.state = "entered";
		socketio.sockets.in(data.sessname).emit('userstate', data);
	});

	socket.on('roommsg', function(datamsg){
		
		socketio.sockets.in(datamsg.sessname).emit('chatmsg', datamsg);
	});

	socket.on('leave', function(data){
		console.log(data.uname+" has left "+data.sessname);
		socket.leave(data.sessname);
		data.state = "left";
		socketio.sockets.in(data.sessname).emit('userstate', data);
	});

});